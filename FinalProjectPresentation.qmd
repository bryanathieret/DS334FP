---
title: "Adverse Childhood Events and Alcohol Consumption"
format: revealjs
---

```{r}
library(tidyverse)
library(knitr)
library(here)
library(haven)
library(emmeans)
library(lmerTest)
library(lme4)
library(plotly)
library(maps)
library(mapproj)
library(usmap)
library(knitr)
library(broom)
library(modelr)
library(gridExtra)

everything <- read_csv("everything.csv")
```


```{r echo=FALSE}
perweek = everything |> select(MentalIllness, Alcoholic, Incarcerated, SeparationDivorce, DomesticViolence, PhysicalAbuse, EmotionalAbuse, SexualAbuse1, SexualAbuse2, SexualAbuse3, Neglect1, Neglect2, SubstanceAddiction, ALCDAY4, ALCDAY5, sex, age, race, number) |>
  mutate(perweek = case_when(
    ALCDAY5 == 101 ~ 1,
    ALCDAY5 == 102 ~ 2,
    ALCDAY5 == 103 ~ 3,
    ALCDAY5 == 104 ~ 4,
    ALCDAY5 == 105 ~ 5,
    ALCDAY5 == 106 ~ 6,
    ALCDAY5 == 107 ~ 7,
    ALCDAY4 == 101 ~ 1,
    ALCDAY4 == 102 ~ 2,
    ALCDAY4 == 103 ~ 3,
    ALCDAY4 == 104 ~ 4,
    ALCDAY4 == 105 ~ 5,
    ALCDAY4 == 106 ~ 6,
    ALCDAY4 == 107 ~ 7)) |>
  mutate(sex = if_else(sex == 1, "Male", "Female")) |>
  mutate(sex = as.factor(sex),
         age = as.factor(age),
         race = as.factor(race),
         MentalIllness = as.factor(MentalIllness),
         Alcoholic = as.factor(Alcoholic),
         Incarcerated = as.factor(Incarcerated),
         SeparationDivorce = as.factor(SeparationDivorce),
         DomesticViolence = as.factor(DomesticViolence),
         PhysicalAbuse = as.factor(PhysicalAbuse),
         EmotionalAbuse = as.factor(EmotionalAbuse),
         SexualAbuse1 = as.factor(SexualAbuse1),
         SexualAbuse2 = as.factor(SexualAbuse2),
         SexualAbuse3 = as.factor(SexualAbuse3),
         Neglect1 = as.factor(Neglect1),
         Neglect2 = as.factor(Neglect2),
         SubstanceAddiction = as.factor(SubstanceAddiction)) |>
  filter(!is.na(perweek)) |>
mutate(age = case_when(
    age == 1 ~ "18 to 24",
    age == 2 ~ "25 to 34",
    age == 3 ~ "35 to 44",
    age == 4 ~ "45 to 54",
    age == 5 ~ "55 to 64",
    age == 6 ~ "65 or > 65"))

perweek2 = everything |> select(MentalIllness, Alcoholic, Incarcerated, SeparationDivorce, DomesticViolence, PhysicalAbuse, EmotionalAbuse, SexualAbuse1, SexualAbuse2, SexualAbuse3, Neglect1, Neglect2, SubstanceAddiction, ALCDAY4, ALCDAY5, sex, age, race, number) |>
  mutate(perweek = case_when(
    ALCDAY5 == 101 ~ 1,
    ALCDAY5 == 102 ~ 2, 
    ALCDAY5 == 103 ~ 3,
    ALCDAY5 == 104 ~ 4, 
    ALCDAY5 == 105 ~ 5,
    ALCDAY5 == 106 ~ 6,
    ALCDAY5 == 107 ~ 7,
    ALCDAY4 == 101 ~ 1,
    ALCDAY4 == 102 ~ 2,
    ALCDAY4 == 103 ~ 3,
    ALCDAY4 == 104 ~ 4,
    ALCDAY4 == 105 ~ 5,
    ALCDAY4 == 106 ~ 6,
    ALCDAY4 == 107 ~ 7)) |>
  mutate(sex = if_else(sex == 1, "Male", "Female")) |>
  filter(!is.na(perweek)) 

perweek2 = perweek2 |> 
  select(c(1:13)) |>
  mutate(
    MentalIllness = if_else(is.na(MentalIllness), 0, MentalIllness),
    Alcoholic = if_else(is.na(Alcoholic), 0, Alcoholic),
    Incarcerated = if_else(is.na(Incarcerated), 0, Incarcerated),
    SeparationDivorce = if_else(is.na(SeparationDivorce), 0, SeparationDivorce),
    DomesticViolence = if_else(is.na(DomesticViolence), 0, DomesticViolence),
    PhysicalAbuse = if_else(is.na(PhysicalAbuse), 0, PhysicalAbuse),
    EmotionalAbuse = if_else(is.na(EmotionalAbuse), 0, EmotionalAbuse),
    SexualAbuse1 = if_else(is.na(SexualAbuse1), 0, SexualAbuse1),
    SexualAbuse2 = if_else(is.na(SexualAbuse2), 0, SexualAbuse2),
    SexualAbuse3 = if_else(is.na(SexualAbuse3), 0, SexualAbuse3),
    Neglect1 = if_else(is.na(Neglect1), 0, Neglect1), 
    Neglect2 = if_else(is.na(Neglect2), 0, Neglect2),
    SubstanceAddiction = if_else(is.na(SubstanceAddiction), 0, SubstanceAddiction)
  )

sumsACEperweek= rowSums(perweek2, na.rm = TRUE)


Categories = c()

one = ""
two = ""
three = ""
four = ""
five = ""
six = ""
seven = ""
eight = ""
nine = ""
ten = ""
eleven = ""
twelve =""
thirteen = ""

for (x in 1:45565) {
  part = perweek2 |> slice(x)
  for (i in 1:13) {
    part1 = as.numeric(part[i])
    if ( part1 == 1 ) {
      if (i == 1) {
        one = "MI"
      }
      if (i == 2){
        two = "A"
      }
      if (i == 3){
        three = "I"
      }
      if (i == 4){
        four = "S/D"
      }
      if (i == 5){
        five = "DV"
      }
      if (i == 6){
        six = "PA"
      }
      if (i == 7){
        seven = "EA"
      }
      if (i == 8){
        eight = "SA1"
      }
      if (i == 9){
        nine = "SA2"
      }
      if (i == 10){
        ten = "SA3"
      }
      if (i == 11){
        eleven = "N1"
      }
      if (i == 12){
        twelve = "N2"
      }
      if (i == 13){
        thirteen = "SubAddic"
      }
    }
    
  }
  Categories[x] = paste(one, two, three, four, five, six, seven, eight, nine, ten, eleven, twelve, thirteen)
  one = ""
  two = ""
  three = ""
  four = ""
  five = ""
  six = ""
  seven = ""
  eight = ""
  nine = ""
  ten = ""
  eleven = ""
  twelve =""
  thirteen = ""
  
}



perweek3 = perweek |>
  mutate(Categories = Categories) |>
  mutate(Categories = str_squish(Categories)) |>
  mutate(Categories = as.factor(Categories)) |>
  mutate(sum = rowSums(perweek2, na.rm = TRUE)) |>
  select(-ALCDAY4, -ALCDAY5, -race, -number)


perweek4 = perweek3 |> 
  group_by(Categories, sum) |>
  summarise(n = n()) |>
  arrange(desc(sum)) |>
  filter(n >= 25) 
```

## Data
* CDC BRFFS survey 
* "How many days per week do you consume at least one alcoholic beverage?"  
* 13 different adverse childhood events categorized  


## During the past 30 days, how many days per week did you have at least one drink of any alcoholic beverage such as beer, wine, a malt beverage or liquor?

* Those that report a history of mental illness in the household that are also between the ages of 25 to 34 show on average a 1.27 times greater number of days per week compared to females between the ages of 18-24 that report no history of an ACE ($\beta_8 = 1.27$, $SE = 0.09$, $t = 2.63$, $p = .0084$). 



## Mental Illness

```{r}
left_join(perweek4, perweek3) |>
group_by(Categories, sum, age) |>
  summarise(mean = mean(perweek),
            n = n(),
            sd = sd(perweek),
            se = sd/sqrt(n)) |>
  filter(n >= 15) |>
  filter(str_detect(Categories, "MI ") | Categories == "MI" | Categories == "") |>
  mutate(Categories = if_else(Categories == "", "None", Categories)) |>
  arrange(sum) |>
  ungroup() |>
  mutate(Categories = fct_reorder(Categories, mean)) |>
  mutate(sum = as.factor(sum)) |>
  ggplot(aes(x = mean, y = Categories, col = sum, fill = age)) + 
  geom_errorbar(aes(xmax = mean+se, xmin = mean-se, col = sum, alpha = se), width = 0.3, linewidth = 0.8) + 
  geom_point(aes(fill = age, col = sum), stroke = 1, size = 3, shape =21) + 
  scale_color_viridis_d(option = "plasma", direction = 1, begin = 0.75, end = 0.40) +
  scale_fill_brewer(palette = "RdPu") +
  theme_minimal() +
  labs(x = "Average Alcoholic Drinks Per Week") +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_text(color = "black", size = 15, family = "Avenir"),
    axis.title.x = element_text(color = "black", size = 20, family = "Avenir"),
    axis.text.x = element_text(color = "black", size = 18, family = "Avenir"),
    legend.text = element_text(color = "black", size = 12, family = "Avenir"),
    legend.position = "right", 
    legend.title = element_blank()
  )

```



